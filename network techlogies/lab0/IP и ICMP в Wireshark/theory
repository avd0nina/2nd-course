Сетевой слой (Network Layer) отвечает за доставку пакетов (марштрутизацию) от одного хоста к другому
Он содержит в себе протоколы маршрутизации, согласно которым составляются пути для пакетов

Основные функции сетевого уровня:
- Маршрутизация (Routing) – выбор пути для пакетов через сеть.
- Логическая адресация (IP-адреса) – идентификация устройств в сети.
- Фрагментация и сборка пакетов – разбиение больших сообщений на части.
- Обнаружение ошибок и управление соединением – через вспомогательные протоколы.

Примеры протоколов сетевого уровня
1. IP (Internet Protocol) – основной протокол
IP определяет, куда отправить пакет и как он дойдёт до получателя.
- IPv4 – использует 32-битные адреса (например, 192.168.1.1).
- IPv6 – использует 128-битные адреса (2001:db8::1), поддерживает больше устройств.
Как IP работает?
Отправитель добавляет в пакет IP-адрес получателя.
Маршрутизаторы (роутеры) пересылают пакет, пока он не достигнет цели.
2. ICMP (Internet Control Message Protocol)
ICMP используется для диагностики сети.
- Ping – проверяет, доступен ли узел.
- Traceroute – показывает маршрут пакета через сеть.
3. Протоколы маршрутизации (RIP, OSPF, BGP)
- RIP (Routing Information Protocol) – простой, использует "количество переходов" (hop count).
- OSPF (Open Shortest Path First) – вычисляет наилучший маршрут по состоянию сети.
- BGP (Border Gateway Protocol) – управляет маршрутизацией в Интернете.

Как сетевой уровень работает в WhatsApp?
Допустим, ты отправляешь сообщение в WhatsApp. Как оно доходит до собеседника?
1. DNS (Domain Name System) переводит whatsapp.com в IP-адрес (192.168.1.1).
2. IP-протокол выбирает маршрут передачи.
3. Пакет передаётся через маршрутизаторы в сети.
4. Если сервер WhatsApp далеко, пакеты проходят через несколько узлов.
5. Сервер получает сообщение и отправляет его получателю.
Если сеть перегружена IP-пакеты могут задерживаться или теряться – тогда TCP (если используется) запрашивает их повторную отправку.

Дополнительные концепции сетевого уровня
1. Фрагментация и сборка пакетов
Если пакет слишком большой для передачи (превышает MTU), он разбивается на части.
MTU (Maximum Transmission Unit) – максимальный размер пакета (обычно 1500 байт в Ethernet).
Если пакет больше MTU, он фрагментируется и собирается обратно на стороне получателя.
2. TTL (Time to Live)
Каждый IP-пакет содержит TTL (время жизни) – число, уменьшающееся на каждом маршрутизаторе.
Если TTL = 0, пакет удаляется, чтобы не зацикливаться в сети.

1. IP (Internet Protocol) – Основной протокол сетевого уровня
IP – это основа Интернета. Он отвечает за адресацию и маршрутизацию пакетов данных в сети.
Как работает IP?
Каждое устройство в сети получает уникальный IP-адрес.
Когда данные передаются, IP определяет маршрут от отправителя к получателю.
Если данные должны пройти через несколько сетей, они пересылаются через маршрутизаторы (routers).
IP не гарантирует доставку пакетов – он просто отправляет их к нужному адресу (по принципу «лучших усилий»).
IP-пакет состоит из заголовка и данных.
Заголовок IP-пакета содержит:
- IP-адрес отправителя
- IP-адрес получателя
- TTL (Time to Live) – сколько узлов (маршрутизаторов) может пройти пакет
- Идентификатор и флаги – для фрагментации и сборки пакетов
- Протокол верхнего уровня (TCP/UDP/ICMP и др.)
Маршрутизация в IP
1) Отправитель формирует IP-пакет с адресом получателя.
2) Если получатель в той же сети – пакет передаётся напрямую.
3) Если в другой сети – пакет передаётся маршрутизатору.
4) Маршрутизаторы анализируют IP-адрес и пересылают пакет по оптимальному маршруту.
5) Если TTL пакета истёк – пакет удаляется, а отправителю возвращается ICMP-сообщение.

2. ICMP (Internet Control Message Protocol) – Служебный протокол диагностики
ICMP используется для обмена служебной информацией между устройствами в сети.
Для чего нужен ICMP?
- Сообщает об ошибках передачи (например, если узел недоступен).
- Используется в Ping и Traceroute для проверки сети.
ICMP-сообщение содержит:
- Тип (Type) – определяет тип сообщения (например, Echo Request для Ping).
- Код (Code) – уточняет тип ошибки.
- Контрольная сумма (Checksum) – проверяет целостность.
- Данные – например, при Ping это случайная строка.
Типы ICMP-сообщений
- Тип 0 (Echo Reply) – ответ на запрос Ping.
- Тип 3 (Destination Unreachable) – узел недоступен.
- Тип 5 (Redirect) – рекомендует другой маршрут.
- Тип 8 (Echo Request) – запрос Ping.
- Тип 11 (Time Exceeded) – TTL истёк (используется в Traceroute).

Ping – проверка доступности хоста
Как работает Ping?
1) Отправитель отправляет ICMP Echo Request на целевой IP.
2) Получатель отвечает ICMP Echo Reply.
3) Если ответ пришёл – узел доступен.
4) Если ответа нет – узел недоступен или есть проблемы в сети. Ping может показать:
- Request timed out – хост не отвечает.
- Destination unreachable – IP-адрес недоступен.
- TTL expired in transit – пакет застрял в сети.

Traceroute – отслеживание маршрута пакета
Traceroute использует ICMP, чтобы показать все маршрутизаторы, через которые проходит пакет.
